# Auth/Login Domain Migration Plan

## Overview
마이그레이션 대상: 7개의 Login Controller와 관련 서비스/DTO
목표: REST API 방식으로 변환하여 com.klid.api.auth 패키지에 배치

## 분석된 기능 그룹

### 1. 기본 로그인 (LoginController)
- `isUserAccountLocked`: 사용자 계정 잠금 확인
- `getLogin`: 로그인 처리
- `prcsLogout`: 로그아웃 (View 반환 - 제외)
- `getOtpGenerate`: OTP 생성
- `getOtpCheck`: OTP 확인
- `editOtpKey`: OTP 키 수정

### 2. CTRS 1차 인증 (LoginCtrsPrimaryController)
- `authenticatePrimary`: CTRS 시스템 1차 인증

### 3. CTRS 2차 인증 (LoginCtrsSecondController)
- `authenticateOtp`: OTP 2차 인증
- `authenticateEmail`: 이메일 2차 인증 발송

### 4. CTSS 1차 인증 (LoginCtssPrimaryController)
- `authenticatePrimary`: CTSS 시스템 1차 인증

### 5. CTSS 2차 인증 (LoginCtssSecondController)
- `authenticateOtp`: OTP 2차 인증

### 6. VMS 1차 인증 (LoginVmsPrimaryController)
- `authenticatePrimary`: VMS 시스템 1차 인증

### 7. VMS 2차 인증 (LoginVmsSecondController)
- `authenticateOtp`: OTP 2차 인증
- `sendEmail`: 이메일 2차 인증 발송
- `validateEmailCode`: 이메일 코드 검증

## 의존성 분석

### 필수 서비스
1. **LoginService**: 기본 로그인 기능
2. **PrimaryCtrsService**: CTRS 1차 인증
3. **OtpService**: OTP 생성/검증
4. **GpkiService**: GPKI 인증서 관리
5. **EmailService**: 이메일 인증
6. **PrimaryCtssService/PrimaryCtssServiceI**: CTSS 1차 인증
7. **PrimaryVmsService/PrimaryVmsServiceI**: VMS 1차 인증
8. **SecondVmsService**: VMS 2차 인증

### 필수 DTO (34개)
- LoginCtrsReqDto, LoginCtssReqDto, LoginVmsReqDto
- LoginCtssResDto, LoginVmsResDto
- AuthenticatePrimaryCtrsResDto
- OtpCheckReqDto
- EmailCheckReqDto, EmailSendInfoDto
- IntegrationLoginInfoDto
- UserDto
- ThirdParty* 관련 DTO 다수

### 공통 유틸리티
- SessionManager
- IntegrationSessionManager
- HttpRequestUtils
- SEED_KISA256 (암호화)
- CustomException
- ReturnData (제거 대상)

## 마이그레이션 전략

### Phase 1: DTO 마이그레이션
1. 모든 요청/응답 DTO를 com.klid.api.auth.dto로 복사
2. ReturnData 의존성 제거
3. 필요시 DTO 병합/정리

### Phase 2: Service 마이그레이션
1. 서비스 클래스들을 com.klid.api.auth.service로 복사
2. Interface 제거, 직접 구현으로 변경
3. @RequiredArgsConstructor 적용
4. final 키워드 적용

### Phase 3: Controller 마이그레이션
1. 각 Controller를 @RestController로 변환
2. ReturnData → ResponseEntity<T> 변환
3. URI에서 .do 제거, kebab-case 적용
4. @ResponseBody 제거 (불필요)
5. 적절한 HTTP status code 반환

### Phase 4: Mapper 인터페이스 추가
1. persistence 패키지에 필요한 Mapper 생성
2. MyBatis XML 매핑 파일 확인/생성

## 새 패키지 구조

```
com.klid.api.auth/
├── controller/
│   ├── LoginController.java (기본 로그인/로그아웃)
│   ├── CtrsAuthController.java (CTRS 1차+2차 통합)
│   ├── CtssAuthController.java (CTSS 1차+2차 통합)
│   └── VmsAuthController.java (VMS 1차+2차 통합)
├── service/
│   ├── LoginService.java
│   ├── PrimaryCtrsService.java
│   ├── PrimaryCtssService.java
│   ├── PrimaryVmsService.java
│   ├── OTPService.java
│   ├── GPKIService.java
│   └── EmailService.java
├── dto/
│   ├── request/
│   │   ├── LoginRequestDTO.java
│   │   ├── CtrsLoginRequestDTO.java
│   │   ├── OTPCheckRequestDTO.java
│   │   └── EmailCheckRequestDTO.java
│   └── response/
│       ├── LoginResponseDTO.java
│       ├── AuthPrimaryResponseDTO.java
│       └── OTPCheckResponseDTO.java
└── persistence/
    ├── LoginMapper.java
    └── OTPMapper.java
```

## URI 매핑 변경

### 기본 로그인
- POST `/login/is-user-account-locked` (isUserAccountLocked)
- POST `/login` (getLogin)
- POST `/logout` (prcsLogout)
- POST `/login/otp/generate` (getOtpGenerate)
- POST `/login/otp/check` (getOtpCheck)
- PUT `/login/otp/key` (editOtpKey)

### CTRS
- POST `/api/auth/ctrs/primary` (1차 인증)
- POST `/api/auth/ctrs/secondary/otp` (2차 OTP)
- POST `/api/auth/ctrs/secondary/email` (2차 이메일 발송)

### CTSS
- POST `/api/auth/ctss/primary` (1차 인증)
- POST `/api/auth/ctss/secondary/otp` (2차 OTP)

### VMS
- POST `/api/auth/vms/primary` (1차 인증)
- POST `/api/auth/vms/secondary/otp` (2차 OTP)
- POST `/api/auth/vms/secondary/email/send` (2차 이메일 발송)
- POST `/api/auth/vms/secondary/email/validate` (2차 이메일 검증)

## 작업 순서

1. ✅ 디렉토리 구조 생성
2. ⬜ DTO 마이그레이션 (request/response 분리)
3. ⬜ Service 마이그레이션 (Interface 제거)
4. ⬜ Controller 마이그레이션 (ResponseEntity 적용)
5. ⬜ Mapper 인터페이스 생성
6. ⬜ 통합 테스트
7. ⬜ 문서화
