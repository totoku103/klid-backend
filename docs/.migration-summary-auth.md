# Auth/Login Domain Migration Summary

## 작업 완료 내역

### 1. 패키지 구조 생성 ✅
```
com.klid.api.auth/
├── controller/
│   ├── CtrsAuthController.java
│   ├── CtssAuthController.java
│   └── VmsAuthController.java
├── service/
├── dto/
│   ├── request/
│   │   ├── LoginRequestDTO.java
│   │   ├── CtrsLoginRequestDTO.java
│   │   ├── CtssLoginRequestDTO.java
│   │   ├── VmsLoginRequestDTO.java
│   │   ├── OTPCheckRequestDTO.java
│   │   └── EmailCheckRequestDTO.java
│   └── response/
│       ├── AuthPrimaryResponseDTO.java
│       ├── CtssAuthPrimaryResponseDTO.java
│       ├── VmsAuthPrimaryResponseDTO.java
│       ├── OTPCheckResponseDTO.java
│       └── EmailSendResponseDTO.java
└── persistence/
```

### 2. DTO 마이그레이션 완료 ✅

#### Request DTOs (6개)
1. **LoginRequestDTO** - 기본 로그인 요청
2. **CtrsLoginRequestDTO** - CTRS 시스템 로그인
3. **CtssLoginRequestDTO** - CTSS 시스템 로그인
4. **VmsLoginRequestDTO** - VMS 시스템 로그인
5. **OTPCheckRequestDTO** - OTP 코드 검증 요청
6. **EmailCheckRequestDTO** - 이메일 코드 검증 요청

#### Response DTOs (5개)
1. **AuthPrimaryResponseDTO** - CTRS 1차 인증 응답 (code, message, otpSecretKey)
2. **CtssAuthPrimaryResponseDTO** - CTSS 1차 인증 응답
3. **VmsAuthPrimaryResponseDTO** - VMS 1차 인증 응답 (email, gpkiKey 포함)
4. **OTPCheckResponseDTO** - OTP 검증 결과 (isPass)
5. **EmailSendResponseDTO** - 이메일 발송 결과 (expiredTimestamp, message)

#### 개선 사항
- Lombok 적용: `@Getter`, `@Setter`, `@AllArgsConstructor`, `@NoArgsConstructor`
- 명확한 네이밍: `*RequestDTO`, `*ResponseDTO`
- request/response 패키지 분리

### 3. Controller 마이그레이션 완료 ✅

#### CtrsAuthController
**베이스 경로**: `/api/auth/ctrs`

| 원본 메소드 | 새 엔드포인트 | HTTP | 설명 |
|------------|-------------|------|------|
| authenticatePrimary | `/api/auth/ctrs/primary` | POST | CTRS 1차 인증 |
| authenticateOtp | `/api/auth/ctrs/secondary/otp` | POST | CTRS 2차 OTP 인증 |
| authenticateEmail | `/api/auth/ctrs/secondary/email` | POST | CTRS 2차 이메일 인증 |

#### CtssAuthController
**베이스 경로**: `/api/auth/ctss`

| 원본 메소드 | 새 엔드포인트 | HTTP | 설명 |
|------------|-------------|------|------|
| authenticatePrimary | `/api/auth/ctss/primary` | POST | CTSS 1차 인증 |
| authenticateOtp | `/api/auth/ctss/secondary/otp` | POST | CTSS 2차 OTP 인증 |

#### VmsAuthController
**베이스 경로**: `/api/auth/vms`

| 원본 메소드 | 새 엔드포인트 | HTTP | 설명 |
|------------|-------------|------|------|
| authenticatePrimary | `/api/auth/vms/primary` | POST | VMS 1차 인증 |
| authenticateOtp | `/api/auth/vms/secondary/otp` | POST | VMS 2차 OTP 인증 |
| sendEmail | `/api/auth/vms/secondary/email/send` | POST | VMS 이메일 발송 |
| validateEmailCode | `/api/auth/vms/secondary/email/validate` | POST | VMS 이메일 코드 검증 |

#### 적용된 컨벤션
1. ✅ `@RestController` 사용
2. ✅ `@RequiredArgsConstructor`로 생성자 주입
3. ✅ `ReturnData` → `ResponseEntity<T>` 변환
4. ✅ `.do` 확장자 제거
5. ✅ kebab-case URI 사용
6. ✅ `final` 키워드 적용
7. ✅ SLF4J Logger 사용 (log4j → slf4j)
8. ✅ 명확한 HTTP 메소드 매핑

### 4. 의존성 분석

#### 현재 사용 중인 기존 클래스들
- `com.klid.webapp.common.service.PrimaryCtrsService`
- `com.klid.webapp.common.service.PrimaryCtssServiceI`
- `com.klid.webapp.common.service.PrimaryVmsServiceI`
- `com.klid.webapp.common.service.OtpService`
- `com.klid.webapp.common.service.GpkiService`
- `com.klid.webapp.common.service.EmailService`
- `com.klid.webapp.common.service.SecondVmsService`
- `com.klid.common.SessionManager`
- `com.klid.common.IntegrationSessionManager`
- `com.klid.common.HttpRequestUtils`
- `com.klid.common.SEED_KISA256`
- `com.klid.webapp.common.CustomException`
- `com.klid.webapp.common.dto.*` (다수)

**참고**: 이 클래스들은 기존 프로젝트에 이미 존재하므로 그대로 사용합니다.

## 마이그레이션하지 않은 항목

### LoginController의 일부 메소드
- `prcsLogout` - View 반환 메소드로 제외 (리다이렉트 처리)
- 기본 로그인 메소드들 (`isUserAccountLocked`, `getLogin`, `getOtpGenerate`, `getOtpCheck`, `editOtpKey`)
  - 이들은 별도로 마이그레이션 필요 (향후 작업)

## API 엔드포인트 요약

### CTRS 인증
```
POST /api/auth/ctrs/primary
Request: { "id": "user123", "password": "****" }
Response: { "code": "OK", "message": "정상", "otpSecretKey": "..." }

POST /api/auth/ctrs/secondary/otp
Request: { "userCode": "123456" }
Response: { "isPass": true }

POST /api/auth/ctrs/secondary/email
Request: {}
Response: { "expiredTimestamp": 1234567890, "message": "발송 완료" }
```

### CTSS 인증
```
POST /api/auth/ctss/primary
Request: { "id": "user123", "password": "****" }
Response: { "otpSecretKey": "..." }

POST /api/auth/ctss/secondary/otp
Request: { "userCode": "123456" }
Response: { "isPass": true }
```

### VMS 인증
```
POST /api/auth/vms/primary
Request: { "id": "user123", "password": "****" }
Response: { "otpSecretKey": "...", "email": "user@example.com", "gpkiKey": "..." }

POST /api/auth/vms/secondary/otp
Request: { "userCode": "123456" }
Response: { "isPass": true }

POST /api/auth/vms/secondary/email/send
Request: {}
Response: { "expiredTimestamp": 1234567890, "message": "발송 완료" }

POST /api/auth/vms/secondary/email/validate
Request: { "userCode": "123456" }
Response: { "isPass": true }
```

## 다음 단계

### 추가 작업 필요
1. ⬜ 기본 LoginController 마이그레이션
   - `isUserAccountLocked`
   - `getLogin`
   - `getOtpGenerate`
   - `getOtpCheck`
   - `editOtpKey`

2. ⬜ Service 클래스 마이그레이션 (선택사항)
   - 현재는 기존 서비스 재사용
   - 필요시 `com.klid.api.auth.service`로 복사/리팩토링

3. ⬜ 통합 테스트 작성

4. ⬜ API 문서화 (Swagger/OpenAPI)

## 파일 위치

### 새로 생성된 파일
```
/Users/totoku103/IdeaProjects/klid-backend/src/main/java/com/klid/api/auth/
├── controller/
│   ├── CtrsAuthController.java
│   ├── CtssAuthController.java
│   └── VmsAuthController.java
└── dto/
    ├── request/
    │   ├── LoginRequestDTO.java
    │   ├── CtrsLoginRequestDTO.java
    │   ├── CtssLoginRequestDTO.java
    │   ├── VmsLoginRequestDTO.java
    │   ├── OTPCheckRequestDTO.java
    │   └── EmailCheckRequestDTO.java
    └── response/
        ├── AuthPrimaryResponseDTO.java
        ├── CtssAuthPrimaryResponseDTO.java
        ├── VmsAuthPrimaryResponseDTO.java
        ├── OTPCheckResponseDTO.java
        └── EmailSendResponseDTO.java
```

## 컨벤션 준수 체크리스트

- ✅ `@RestController` 사용
- ✅ `ResponseEntity<T>` 사용 (ReturnData 제거)
- ✅ URI에서 `.do` 제거
- ✅ kebab-case URI
- ✅ `@RequiredArgsConstructor` 의존성 주입
- ✅ 변수에 `final` 사용
- ✅ Interface 없이 직접 구현 (Service는 기존 것 재사용)
- ✅ 축약어 대문자 (OTP, DTO, API)
- ✅ 적절한 HTTP 메소드 사용 (POST, PUT, DELETE)
- ✅ SLF4J Logger 사용

## 완료 상태
- 총 7개 원본 컨트롤러 중 **3개 통합 컨트롤러로 마이그레이션 완료**
- 11개 DTO 생성 완료
- 9개 REST API 엔드포인트 생성 완료
